---
title: "Seattle Car Crashes"
author: "Simoli Aghara, Mindy Chen, Rachel Graham, Tammy Le"
date: "`r Sys.Date()`"
output: 
  flexdashboard::flex_dashboard:
    orientation: columns
    vertical_layout: fill
runtime: shiny
---

```{r setup, include=FALSE}
library(flexdashboard)
```


About
===================================== 

### About Section

This is about Seattle Car Crashes. 

Table
===================================== 

```{r}
library(readxl)
library(tidyverse)
library(DT)
library(dplyr)
library(ggplot2)
library(shiny)
Seattle_Car_Crashes <- read_excel("Seattle Car Crashes.xlsx")
Seattle_Car_Crashes <- na.omit(Seattle_Car_Crashes)
Seattle_Car_Crashes <- subset(Seattle_Car_Crashes, select = -c(INCDTTM))
datatable(Seattle_Car_Crashes)

```


Geolocation
===================================== 

Scatter + Line
===================================== 

Scatter plot: Correlation between weather conditions, daylight vs nighttime, and road conditions. - Rachel 
Line Graph: Correlation between date, and time(daylight vs nighttime) - Simoli

```{r chartspage4}
Seattle_Car_Crashes <- Seattle_Car_Crashes %>%
  mutate(Weather_Combined = case_when(
    WEATHER %in% c("Clear", "Overcast", "Partly Cloudy") ~ "Clear",
    WEATHER %in% c("Fog/Smog/Smoke") ~ "Fog",
    WEATHER %in% c("Raining", "Sleet/Hail/Freezing Rain") ~ "Rain",
    WEATHER %in% c("Snowing", "Blowing Snow") ~ "Snow",
    WEATHER %in% c("Other", "Blowing Sand/Dirt", "Severe Crosswind") ~ "Other",
    TRUE ~ WEATHER  # Keep other values unchanged
  )) %>%

  mutate(Light_Combined = case_when(
    LIGHTCOND == "Daylight" ~ "Daylight",
    LIGHTCOND %in% c("Dawn", "Dusk") ~ "Dawn/Dusk",
    LIGHTCOND %in% c("Dark - Street Lights On", "Dark - Unknown Lighting", "Dark - Street Lights Off", "Dark - No Street Lights") ~ "Dark",
    TRUE ~ LIGHTCOND  # Keep other values unchanged
  )) %>%
  
  mutate(Road_Combined = case_when(
    ROADCOND == "Dry" ~ "Dry",
    ROADCOND %in% c("Wet", "Standing Water", "Snow/Slush", "Sand/Mud/Dirt", "Oil") ~ "Wet",
    ROADCOND == c("Ice") ~ "Ice",
    TRUE ~ ROADCOND  # Keep other values unchanged
  )) %>%
  
  # Filter out rows with "Unknown" or "Other" values in the specified columns
  filter(WEATHER != "Unknown" & LIGHTCOND != "Unknown" & LIGHTCOND != "Other" & ROADCOND != "Unknown" & ROADCOND != "Other")

crash_counts <- Seattle_Car_Crashes %>%
  group_by(Weather_Combined, Light_Combined, Road_Combined) %>%
  summarise(Count = n())

# Plot
ggplot(crash_counts, aes(x = Weather_Combined, y = Count, color = Light_Combined, shape = Road_Combined)) +
  geom_point(size = 3) +
  labs(x = "Weather Condition", y = "Number of Car Crashes", color = "Light Condition", shape = "Road Condition") +
  theme_minimal() +
  theme(axis.text.x = element_text(angle = 45, hjust = 1))  # Rotate x-axis labels for better readability

```

```{r}
# Separating the date column from the dataset
Seattle_Car_Crashes_Date <- Seattle_Car_Crashes %>%
  mutate(year = year(INCDATE), month = month(INCDATE))

# Counting the total number of accidents happened in a particular month
total_accident <- Seattle_Car_Crashes_Date %>%
  group_by(LIGHTCOND, year, month) %>%
  summarise(Number_Accidents = n())

# Making the graph interactive
ui <- fluidPage(

  # Giving the title to the graph
  titlePanel("Car Crashes by Light Condition over Time"),
  
  # Lets the user choose which year they want to view
  sidebarLayout(
    sidebarPanel(
      selectInput("year", "Select Year", choices = unique(total_accident$year))
    ),
    
    # The output
    mainPanel(
      plotOutput("plot")
    )
  )
)

server <- function(input, output) {
  # Creating the data with the year selected by the user
  data <- reactive({
    filter(total_accident, year == input$year)
  })
  

  output$plot <- renderPlot({
    # Creating the plot
    ggplot(data(), aes(x = paste(year, month, sep = "-"), y = Number_Accidents, group = LIGHTCOND, color = LIGHTCOND)) +
      geom_line() +
      labs(x = "Year-Month", y = "Number of Accidents", title = paste("Car Crashes by Light Condition in", input$year))
  })
}

shinyApp(ui = ui, server = server)
```

Scatter + Bar
===================================== 

Bar Graph: Type of Accident and Junction and Severity - Mindy
Scatter plot: Compare most injuries/severies to Junction (intersections) - Tammy 
